!function(){"use strict";function e(e,n,t,r,i,o){r.factory("$stateProvider",function(){return e}),r.factory("$urlRouterProvider",function(){return n}),i.interceptors.push("httpRequestInterceptor"),t.debugEnabled(!1),o.setPrefix("yourAppName").setStorageType("sessionStorage").setNotify(!0,!0)}function n(e,n,t){function r(e){var n=/admin\/api\/admin\/users\/\S+\/roles/,t=/admin\/api\/sessions\/\S+/,r=/admin\/api\/admin\/users\/\S+\/permissions/;n.test(e.url)||t.test(e.url)||r.test(e.url)||s.push(e.promiseObj)}function i(e){angular.forEach(e,function(e,n){e&&e.resolve()})}function o(){var e=angular.copy(s);s=[],i(e)}var s=[];return e.$on("$stateChangeSuccess",function(){o()}),{request:function(e){var n=t.defer();return e.timeout=n.promise,r({url:e.url,promiseObj:n}),e},requestError:function(e){return t.reject(e)},response:function(e){return e||t.when(e)},responseError:function(e){switch(e.status){case 0:break;case 401:n.displayError("您已经退出系统，请刷新页面重新登录!",12e5);break;case 403:n.displayError("请求无效，请勿进行越权操作!");break;case 500:n.displayError("后台发生未知错误，请尽快通知系统管理员!",12e5);break;default:n.displayError(e.status+"，请求失败！")}return t.reject(e)}}}function t(e,n,t,r,i,o,s,a,l,u){function c(e,n,t,r){for(var i=0;i<n.length;i++)if(e.children)for(var o=0;o<e.children.length;o++)e.children[o].name===n[r]&&(r=++r,t.push(e.children[o].displayName),c(e.children[o],n,t,r))}var d=l.state("app",{url:"/app","abstract":!0,templateUrl:"views/index.html"}).state("app.dashboard",{url:"^/dashboard",templateUrl:"views/dashboard.html",controller:"DashboardCtrl",parent:"app"}).state("app.admin",{url:"^/admin",template:"<div ui-view></div>",parent:"app"}).state("app.admin.user",{url:"/user",templateUrl:"views/admin/user.html",controller:"UserCtrl"}).state("app.admin.role",{url:"/role",templateUrl:"views/admin/role.html",controller:"RoleCtrl"}).state("app.admin.permission",{url:"/permission",templateUrl:"views/admin/permission.html",controller:"PermissionCtrl"}).state("app.admin.codec",{url:"/codec",templateUrl:"views/admin/codec.html",controller:"CodecCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"});d=a.configRoutes(d),u.otherwise("/login"),e.globals={user:{resolved:!1,login:!1},errors:[],isRefresh:!0},i.setBaseUrl(a.basePath),i.addResponseInterceptor(function(e){var n;return e&&e.error?(o.displayError(e.error.message),n=e,e.error.debugMessage&&r.debug(e.error.debugMessage)):e.data?(n=e.data,e.pagination&&(n.pagination=e.pagination)):n=e,n}),i.setErrorInterceptor(function(e){return 401===e.status?(o.displayError("您已经退出系统，请刷新页面重新登录!",12e5),!1):403===e.status?(o.displayError("请求无效，请勿进行越权操作!"),!1):500===e.status?(o.displayError("后台发生未知错误，请尽快通知系统管理员!",12e5),!1):!0}),e.$on("$locationChangeStart",function(t,r){var i=r.split("#")[1];if(i){var o=e.globals.user;o&&o.login?"/login"===i&&o&&o.login&&t.preventDefault():n.path("/login")}else t.preventDefault()}),e.$on("$locationChangeSuccess",function(){for(var t=a.menuList,r=[],i=_.compact(n.path().split("/")),o=0;o<t.length;o++)t[o].name===i[0]&&(r.push(t[o].displayName),c(t[o],i,r,1));e.displayNameList=r});var p=n.path(),m=e.globals.user;"/login"!==p?s.one(1).get().then(function(t){t&&t.name?(m.login=!0,m.unavailable=!1,m.id=t.id,m.name=t.name,e.$emit("setup-menu",{path:p,isRefresh:!0}),p&&"/"!==p?n.path(p):n.path("/dashboard")):(m.login=!1,m.unavailable=!0,n.path("/login"))}):(m.unavailable=!0,n.path("/login"))}angular.module("adminApp",["ui.router","restangular","ngAnimate","angular-loading-bar","datatables","datatables.bootstrap","datatables.fixedcolumns","highcharts-ng","ui.bootstrap","ngSanitize","ui.bootstrap.tpls","ngFileUpload","isteven-multi-select","textAngular","emojiApp","daterangepicker","LocalStorageModule"]).config(e).factory("httpRequestInterceptor",n).run(t),e.$inject=["$stateProvider","$urlRouterProvider","$logProvider","$provide","$httpProvider","localStorageServiceProvider"],t.$inject=["$rootScope","$location","$http","$log","Restangular","Utils","Session","Config","$stateProvider","$urlRouterProvider"],n.$inject=["$rootScope","Utils","$q"]}(),function(){"use strict";function e(e,n){var t=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d]{12,}$/;return{isComplexPassword:function(e){var n=!1;return e&&t.test(e)&&(n=!0),n},displayError:function(t,r){r=r||5e3;var i=e.globals;t&&(_.isObject(t)?i.errors=_.map(t,function(e){return _.isArray(e)?e[0]:e}):_.isString(t)&&(i.errors=[t]),n(function(){i.errors=[]},r))},extractData:function(e){return e&&e.data?e.data.length>1?e.data:e.data[0]:e},initSidebar:function(){$("#side-menu").find("li").has("ul").children("a").prop("onclick",null).off("click"),$("#side-menu").metisMenu()},buildDtInstanceCb:function(e,n){return function(t){e&&n&&t&&t.dataTable&&t.dataTable.on("length.dt",function(){e.$apply(n)}).on("page.dt",function(){e.$apply(n)})}},setCurrentWeek:function(e){var n=moment().startOf("week"),t=moment(),r={};return moment(n).isSame(t)?r.startDate=n.subtract(1,"weeks").format("YYYY-MM-DD"):r.startDate=n.format("YYYY-MM-DD"),r.endDate=moment().subtract(1,"days").format("YYYY-MM-DD"),e(r)},setCurrentMonth:function(e){var n=moment().startOf("month"),t=moment(),r={};return moment(n).isSame(t)?r.startDate=n.subtract(1,"months").format("YYYY-MM-DD"):r.startDate=n.format("YYYY-MM-DD"),r.endDate=moment().subtract(1,"days").format("YYYY-MM-DD"),e(r)},setPreviousMonth:function(e){var n={};return n.startDate=moment().startOf("month").subtract(1,"months").format("YYYY-MM-DD"),n.endDate=moment().endOf("month").subtract(1,"months").format("YYYY-MM-DD"),e(n)}}}angular.module("adminApp").factory("Utils",e),e.$inject=["$rootScope","$timeout"]}(),function(){"use strict";function e(e){function n(n){var t=e.newOptions().withPaginationType("full_numbers").withDisplayLength(10).withBootstrap().withLanguage(s);return n?n(t):t}function t(e){return e}function r(){}var i="AppGame 后台基础框架",o=[{name:"dashboard",displayName:"Dashboard",url:"app.dashboard",icon:"fa-dashboard"},{name:"admin",displayName:"后台管理",url:"app.admin",icon:"fa-cog",children:[{name:"user",displayName:"用户设置",url:"app.admin.user"},{name:"role",displayName:"角色设置",url:"app.admin.role"},{name:"permission",displayName:"权限设置",url:"app.admin.permission"},{name:"codec",displayName:"编码设置",url:"app.admin.codec"}]}],s={sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 项结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"显示第 0 至 0 项结果，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},a={selectAll:"全选",selectNone:"全不选",reset:"重置",search:"搜索",nothingSelected:"未选择"},l={cancelLabel:"取消",applyLabel:"确定",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]};return{appTitle:i,prepareDynamicMenu:r,configRoutes:t,menuList:o,getDtOptions:n,tableWithLanguage:s,multiSelectWithLanguage:a,datePickerLanguage:l,basePath:"admin/api"}}angular.module("adminApp").factory("Config",e),e.$inject=["DTOptionsBuilder"]}(),function(){"use strict";function e(e,n,t,r,i,o,s,a){function l(){o.getList({includeRoles:!0}).then(function(t){"owner"!==e.globals.user.name&&_.find(t,{name:"owner"})&&_.remove(t,{name:"owner"}),n.userList=t,_.forEach(n.userList,function(e){c(e)})}),s.getList().then(function(t){"owner"!==e.globals.user.name&&_.find(t,{name:"owner"})&&_.remove(t,{name:"owner"}),n.roleList=t}),n.$watch("user.active",function(e){0===e?(n.btnName="停用",n.active=!1):1===e&&(n.btnName="启用",n.active=!0)},!0)}function u(){n.user={},v=-1,n.user.active=1}function c(e){0===e.active?e.activeName="停用":1===e.active&&(e.activeName="启用")}function d(){u()}function p(e){v=e;var t=i.copy(n.userList[v]);t&&(n.user=t)}function m(){var e=n.user;if(c(e),e&&e.name&&e.email){if(e.displayPassword){var t=a.isComplexPassword(e.displayPassword);if(!t)return void a.displayError("密码必须含有大小写字母、数字且不小于12位！");e.password=e.displayPassword,e.password_confirmation=e.displayPassword}else e.password_confirmation=e.password;!e.id&&e.displayPassword?o.post(e).then(function(e){e.error||(c(e),n.userList.push(e)),u()},function(){u()}):e.id&&e.save().then(function(t){t.error||n.userList.splice(v,1,e),u()},function(){u()})}}function f(e){v=e,n.roleType=0,w=[],b=n.userList[e].id,o.one(b).getList("roles").then(function(e){e.length&&(n.roleType=e[0].id)})}function g(){n.roleType?o.one(b).customPUT("","roles",{ids:n.roleType}).then(function(e){e.error?console.warn(e.error.message):(n.userList[v].roles=[],n.userList[v].roles[0]=_.find(n.roleList,{id:parseInt(n.roleType)}))}):a.displayError("请选择角色！"),$("#myModal").modal("hide")}function h(t){var r=!1,i=n.userList[t];return i&&"admin"===i.name&&"owner"!==e.globals.user.name&&(r=!0),r}r.getDtOptions(function(e){n.dtOptions=e.withOption("scrollX",!0)}),n.dtColumnDefs=[t.newColumnDef(3).notSortable(),t.newColumnDef(4).notSortable()],n.dtInstanceCb=a.buildDtInstanceCb(n,u),n.cancelEdit=d,n.editUser=p,n.saveUser=m,n.setUserRole=f,n.saveUserRole=g,n.editDisabled=h;var v=-1,b=-1,w=[];n.user={},n.user.active=1,l()}angular.module("adminApp").controller("UserCtrl",e),e.$inject=["$rootScope","$scope","DTColumnDefBuilder","Config","Restangular","User","Role","Utils"]}(),function(){"use strict";function e(e,n,t,r,i,o,s,a,l){function u(){o.getList().then(function(t){"owner"!==e.globals.user.name&&_.find(t,{name:"owner"})&&_.remove(t,{name:"owner"}),n.roleList=t}),s.getList().then(function(e){n.permissionList=e,n.permissionCategories=p(e)}),l.getList().then(function(e){n.permissionType=_.filter(e,"group","permissionType")})}function c(e){var n=e.indexOf(":");return-1!==n?e.substring(0,n):void 0}function d(e){var n=e.indexOf(":");if(-1!==n)var e=e.substring(n+1);var t=e.indexOf(":");return e.substring(0,t)}function p(e){var t=[],r={},i=0,o=[];return _.each(e,function(e){var o=c(e.displayName);o&&!_.includes(t,o)&&t.push(o),r[o]&&0!==r[o].length||(r[o]=[]);var s=d(e.displayName);s&&!_.includes(r[o],s)&&r[o].push(s),n.permissionList[i]._categorieName=o,n.permissionList[i]._itemName=s,i++}),_.each(t,function(e){var n={categorieNames:e,itemName:r[e]};o.push(n)}),o}function m(){n.role={},L=-1}function f(e){var t=n.permissionCategories[e].categorieNames,r=n.selectedAll.status[e];r===!0&&_.forEach(_.filter(n.permissionList,{_categorieName:t,status:!1}),function(e){e.status=!0}),r===!1&&_.forEach(_.filter(n.permissionList,{_categorieName:t,status:!0}),function(e){e.status=!1})}function g(){m()}function h(e){L=e;var t=i.copy(n.roleList[L]);t&&(n.role=t)}function v(){var e=n.role;e&&e.name&&(e.id?e.save().then(function(t){t.error||n.roleList.splice(L,1,e),m()},function(){m()}):o.post(e).then(function(e){e.error||n.roleList.push(e),m()},function(){m()}))}function b(e){D=[],C=n.roleList[e].id,L=e,o.one(C).getList("permissions").then(function(e){var t=n.permissionList;if(e)for(var r=0;r<t.length;r++){n.permissionList[r].status=!1;for(var i=0;i<e.length;i++)t[r].id===e[i].id&&(n.permissionList[r].status=!0,D.push(e[i].id))}n.selectedAll.status=[];var o=!1;_.forEach(n.permissionCategories,function(e,t){n.selectedAll.status[t]=!1;var r=_.filter(n.permissionList,{_categorieName:e.categorieNames}),i=_.filter(n.permissionList,{_categorieName:e.categorieNames,status:o});0===i.length&&(n.selectedAll.status[t]=!o),r.length===i.length&&(n.selectedAll.status[t]=o)})})}function w(){for(var t=[],r=0;r<n.permissionList.length;r++)n.permissionList[r].status&&t.push(n.permissionList[r].id);var i=t.sort().toString(),s=D.sort().toString();i!==s&&o.one(C).customPUT("","permissions",{ids:i}).then(function(t){t.error&&console.warn(t.error),t.error||e.globals.user.name!==n.roleList[L].name||e.$emit("setup-menu",{isRefresh:!1,isUpload:!1})}),$("#myModal").modal("hide")}function y(t){var r=!1,i=n.roleList[t];return i&&"admin"===i.name&&"owner"!==e.globals.user.name&&(r=!0),r}n.dtOptions=r.getDtOptions(),n.dtColumnDefs=[t.newColumnDef(4).notSortable()],n.dtInstanceCb=a.buildDtInstanceCb(n,m),n.cancelEdit=g,n.editRole=h,n.saveRole=v,n.setRolePermission=b,n.saveRolePermission=w,n.changeStatus=f,n.editDisabled=y,u();var L=-1,C=-1,D=[];n.selectedAll={},n.selectedAll.status=[]}angular.module("adminApp").controller("RoleCtrl",e),e.$inject=["$rootScope","$scope","DTColumnDefBuilder","Config","Restangular","Role","Permission","Utils","Codec"]}(),function(){"use strict";function e(e,n,t,r,i,o,s,a){function l(n){m=m?m:$("#permissionTable").DataTable(),e.permission={},n?(m.search(n.displayName+":").draw(),e.permission.displayName=n.displayName+":",e.permission.name=n.name+":"):m.search("").draw()}function u(){e.permission={},f=-1,e.selectedId=""}function c(){u()}function d(n){f=n;var t=i.copy(e.permissionList[f]);if(t)if(t.readOnly){var r=o.confirm("此权限是系统自动生成的，确定要对其进行修改?");r?e.permission=t:u()}else e.permission=t}function p(){var n=e.permission;n&&n.name?n.id?n.save().then(function(t){t.error||e.permissionList.splice(f,1,n),u()},function(){u()}):r.post(n).then(function(n){n.error||e.permissionList.push(n),u()},function(){u()}):s.displayError("请填写完整*号必填项")}e.dtOptions=t.getDtOptions(),e.dtColumnDefs=[n.newColumnDef(4).notSortable()],e.dtInstanceCb=s.buildDtInstanceCb(e,u),e.cancelEdit=c,e.editPermission=d,e.savePermission=p,e.changeType=l,e.permissionType=[],r.getList().then(function(n){e.permissionList=n;var t=[];_.forEach(e.permissionList,function(n){var r=n.displayName.split(":").slice(0,2).join(":");if(-1===t.indexOf(r)){t.push(r);var i={};i.displayName=r,i.name=n.name.split(":").slice(0,2).join(":"),e.permissionType.push(i)}})});var m,f=-1}angular.module("adminApp").controller("PermissionCtrl",e),e.$inject=["$scope","DTColumnDefBuilder","Config","Permission","Restangular","$window","Utils","Codec"]}(),function(){"use strict";function e(e,n,t,r,i,o,s){function a(){r.getList().then(function(n){e.codecList=n,_.forEach(e.codecList,function(e){l(e)})}),e.$watch("codec.active",function(n){0===n?(e.btnName="启用",e.active=!1):1===n&&(e.btnName="关闭",e.active=!0)},!0)}function l(e){0===e.active?e.activeName="关闭":1===e.active&&(e.activeName="启用")}function u(){e.codec={},m=-1,e.codec.active=1}function c(){u()}function d(n){m=n;var t=i.copy(e.codecList[m]);t&&(e.codec=t)}function p(){var n=e.codec;l(n),n&&n.group&&n.name?(n.comment=n.comment?n.comment:"",n.id?n.save().then(function(t){t.error||e.codecList.splice(m,1,n),u()},function(){u()}):r.post(n).then(function(n){n.error||(l(n),e.codecList.push(n)),u()},function(){u()})):s.displayError("请填写的所有必填信息(注备注外)！")}e.dtOptions=t.getDtOptions(),e.dtColumnDefs=[n.newColumnDef(5).notSortable(),n.newColumnDef(6).notSortable()],e.dtInstanceCb=s.buildDtInstanceCb(e,u),e.editCodec=d,e.saveCodec=p,e.cancelEdit=c,e.codec={},e.codec.active=1;var m=-1;a()}angular.module("adminApp").controller("CodecCtrl",e),e.$inject=["$scope","DTColumnDefBuilder","Config","Codec","Restangular","$window","Utils"]}(),function(){"use strict";function e(e,n,t,r,i,o,s,a,l,u,c){function d(){var n=!0,t=e.passwordModel;return _.each(t,function(e){return e?void 0:(n=!1,!1)}),t.newPassword&&t.newPassword.length<8?n=!1:i.isComplexPassword(t.newPassword)?t.newPassword!==t.newPasswordRepeat&&(n=!1):n=!1,n}function p(){e.passwordModel={oldPassword:"",newPassword:"",newPasswordRepeat:""}}function m(){c.updateUserProfile(e.passwordModel,function(e){$("#passwordModal").modal("hide"),e?i.displayError(e):g()})}function f(){var e=t.path();return{"before-login":"/login"===e}}function g(){var e=n.globals.user;o.one(1).remove().then(function(){e.login=!1,e.unavailable=!0,e.roles="",e.permissions="",t.url("/login"),h(a.menuList)})}function h(e){_.forEach(e,function(e){e.visible=!1,_.has(e,"children")&&h(e.children)})}function v(e,n){var t=e.id;t&&n&&s.one(t).getList("roles").then(function(n){return e.roles=n,s.one(t).getList("permissions")}).then(function(t){t=b(t),e.permissions=t,n(t.system.resource)})}function b(e){var n={system:{resource:[]}};return _.each(e,function(e){var t=e.name,r=t.split(":");r&&3===r.length&&("action"===r[1]?y(r,n):"resource"===r[1]&&w(r,n))}),n}function w(e,n){var t=e[0],r=e[1],i=e[2];t&&r&&i&&(n[t]=n[t]||{},n[t][r]=n[t][r]||[],n[t][r].push(i))}function y(e,n){var t=e[0],r=e[1],i=e[2];if(t&&r&&i){n[t]=n[t]||{},n[t][r]=n[t][r]||{};var o=i.split("-");if(o&&2===o.length){var s=o[0],a=o[1];n[t][r][a]=n[t][r][a]||[],n[t][r][a].push(s)}}}function L(t){var o=[];_.each(t,function(e){e&&o.push(e)}),h(P),_.each(o,function(e){var n=e.split("-"),t=null,r=P;_.each(n,function(e){r&&(t=_.find(r,{name:e}),t&&(t.visible=!0),r=t&&t.children?t.children:null)})}),e.menuList=P,r(function(){n.globals.isUpload||i.initSidebar(),r(function(){e.menuResolved=!0,n.globals.isRefresh&&D()},300)},500),C()}function C(){var t,r=n.globals.user,i=r.name;r.roles&&(t=_.pluck(r.roles,"displayName"),i+=" (",i+=t.join(", "),i+=")"),e.userDesc=i}function D(){$("li.side-menu").find("a.active").click()}e.appTitle=a.appTitle,u.document.title=a.appTitle,e.logout=g,e.loginPageClass=f,e.passwordModel={oldPassword:"",newPassword:"",newPasswordRepeat:""},e.preparePassword=p,e.updatePassword=m,e.canUpdatePassword=d;var P=a.menuList,R="dashboard";n.$on("setup-menu",function(e,t){if(n.globals.isRefresh=!!t.isRefresh,n.globals.isUpload=!!t.isUpload,a.prepareDynamicMenu(),t&&t.path){var r=t.path.indexOf("/");R=t.path.substring(r+1)}var i=n.globals.user;v(i,L)})}angular.module("adminApp").controller("MainCtrl",e),e.$inject=["$scope","$rootScope","$location","$timeout","Utils","Session","User","Config","$log","$window","Actions"]}(),function(){"use strict";function e(e,n,t,r,i){function o(){var i=e.user.name,o=e.user.password,s=e.user.remember,a=n.globals.user,l={name:i,password:o};s&&(l.remember=1),r.post(l).then(function(e){e.name?(a.name=e.name,a.id=e.id,a.login=!0,a.unavailable=!1,n.$emit("setup-menu",{isRefresh:!1}),t.url("/dashboard")):(a.name="",a.id="",a.login=!1)})}e.appTitle=i.appTitle,e.login=o}angular.module("adminApp").controller("LoginCtrl",e),e.$inject=["$scope","$rootScope","$location","Session","Config"]}(),function(){"use strict";function e(){}angular.module("adminApp").controller("IndexCtrl",e),e.$inject=[]}(),function(){"use strict";function e(){}angular.module("adminApp").controller("DashboardCtrl",e),e.$inject=[]}(),function(){"use strict";angular.module("adminApp").factory("User",["Restangular",function(e){return e.service("admin/users")}]).factory("Role",["Restangular",function(e){return e.service("admin/roles")}]).factory("Permission",["Restangular",function(e){return e.service("admin/permissions")}]).factory("Codec",["Restangular",function(e){return e.service("admin/codecs")}]).factory("Session",["Restangular",function(e){return e.service("sessions")}])}(),function(){"use strict";var e=angular.module("adminApp");e.factory("LeanCloud",["Restangular","$http",function(e,n){function t(){return{"X-AVOSCloud-Application-Id":i,"X-AVOSCloud-Request-Sign":o,"Content-Type":"application/json"}}var r="",i="",o="";return{init:function(e){n.get("/admin/api/getLeanCloudConfig?time="+Date.now()).success(function(n){if(n&&n.data){var s=n.data;r=s.leanCloudAppUrl||r,i=s.leanCloudAppId||i,o=s.leanCloudReqSign||o,e(t())}})},resources:{},actions:{}}}])}(),function(){"use strict";function e(e){return{updateUserProfile:function(n,t){n&&t&&e.post("/admin/api/updateUserProfile",n).then(function(e){if(e&&e.data){var n=e.data;n&&n.error?t(n.error):t()}},function(e){t&&t(e.data)})}}}angular.module("adminApp").factory("Actions",e),e.$inject=["$http"]}();